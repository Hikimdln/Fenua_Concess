<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catalogue - Fenua Concess</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" type="image/png" href="assets/logo1.png">
<style>
/* --- Sidebar user --- */
#userBlock {
  text-align: center;
  padding: 20px 10px 10px 10px;
}

#usernameDisplay {
  font-weight: 900;
  font-size: 1.3rem;
  margin-bottom: 5px;
}

#usernameLine {
  height: 2px;
  background: #fff;
  margin-bottom: 10px;
  width: 80%;
  margin-left:auto;
  margin-right:auto;
}

/* --- Main content --- */
.main-content {
  margin-left:220px;
  padding:80px 30px 30px 30px;
  flex:1;
  min-height:100vh;
  box-sizing:border-box;
}

/* --- Back button --- */
.back-btn {
  margin-bottom:15px;
  padding:10px 20px;
  background:#ff0000;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
  transition:0.3s;
}

.back-btn:hover {
  background:#00b4db;
}

/* --- Table --- */
#catalogueTable {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}

#catalogueTable th, #catalogueTable td {
  border:1px solid #ccc;
  padding:8px;
  text-align:left;
}

#catalogueTable th {
  background:#ff0000;
  color:#fff;
}

#catalogueTable td[colspan="3"] {
  background:#f0f0f0;
  font-weight:bold;
  text-align:center;
}
</style>
<script src="auth.js"></script>
</head>
<body>

<div class="sidebar">
  <div id="userBlock">
    <div id="usernameDisplay"></div>
    <div id="usernameLine"></div>
  </div>
  <h2>Fenua Concess</h2>
  <a href="portail.html">Accueil</a>
  <a href="catalogue.html">Catalogue</a>
  <a href="factures.html">Factures</a>
  <a href="index.html" class="logout" id="logoutBtn">Déconnexion</a>
</div>

<header>Portail Interne - Catalogue des véhicules</header>

<div class="main-content">
  <button class="back-btn" onclick="window.location.href='portail.html'">⬅ Retour</button>

  <table id="catalogueTable">
    <thead>
      <tr>
        <th>Véhicule</th>
        <th>Prix usine</th>
        <th>Prix vente</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<button id="scrollTopBtn" title="Remonter en haut">↑</button>

<script>
// --- Récupère l'utilisateur connecté ---
const user = sessionStorage.getItem('fc_user');
if(user){
  document.getElementById('usernameDisplay').textContent = user;
} else {
  window.location.href = "login.html";
}

// --- Bouton Déconnexion ---
document.getElementById('logoutBtn').addEventListener('click', () => {
  sessionStorage.removeItem('fc_user');
  window.location.href = 'index.html';
});

// --- Lecture CSV ---
fetch('catalogue.csv')
  .then(res => res.text())
  .then(data => {
    const rows = data.split('\n').slice(1);
    const tbody = document.querySelector('#catalogueTable tbody');
    let currentCategory = '';

    rows.forEach(row => {
      if(row.trim() === '') return;
      const cols = row.split(';').map(c => c.trim());

      if(cols[0] && !cols[1] && !cols[2]){
        currentCategory = cols[0];
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 3;
        td.textContent = currentCategory;
        tr.appendChild(td);
        tbody.appendChild(tr);
      } else if(cols[0]){
        const tr = document.createElement('tr');
        tr.title = currentCategory;
        cols.forEach(col => {
          const td = document.createElement('td');
          td.textContent = col || '-';
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      }
    });
  })
  .catch(err => console.error("Erreur lecture CSV :", err));

// --- Scroll Top ---
const scrollBtn = document.getElementById('scrollTopBtn');
window.onscroll = function() {
  scrollBtn.style.display = (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) ? "block" : "none";
};
scrollBtn.addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

// --- Bloquer clic droit / inspecteur ---
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.key === "F12" || e.keyCode === 123) e.preventDefault();
  if(e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key.toUpperCase())) e.preventDefault();
  if(e.ctrlKey && (e.key.toUpperCase() === 'U' || e.keyCode === 85)) e.preventDefault();
});
document.addEventListener('dragstart', e => e.preventDefault());
document.addEventListener('selectstart', e => e.preventDefault());
</script>

</body>
</html>
